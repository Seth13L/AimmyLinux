name: Close empty PRs

on:
  pull_request_target:
    types: [opened, synchronize, reopened]

permissions:
  contents: read
  pull-requests: write

jobs:
  check-empty:
    runs-on: ubuntu-latest

    steps:
      - name: Check for empty PR
        uses: actions/github-script@v7
        with:
          script: |
            const { data: files } = await github.rest.pulls.listFiles({
              owner: context.repo.owner,
              repo: context.repo.repo,
              pull_number: context.issue.number,
              per_page: 1
            });

            if (files.length > 0) {
              console.log('PR has files, skipping');
              return;
            }

            // Add invalid label
            await github.rest.issues.addLabels({
              owner: context.repo.owner,
              repo: context.repo.repo,
              issue_number: context.issue.number,
              labels: ['invalid']
            });

            // Post comment
            await github.rest.issues.createComment({
              owner: context.repo.owner,
              repo: context.repo.repo,
              issue_number: context.issue.number,
              body: `## ‚ùå Empty PR\n\nNo files were uploaded in this pull request.\n\nPlease create a new PR with your model (\`.onnx\`), config (\`.cfg\`), or other changes.\n\nThis PR has been automatically closed.`
            });

            // Close PR
            await github.rest.pulls.update({
              owner: context.repo.owner,
              repo: context.repo.repo,
              pull_number: context.issue.number,
              state: 'closed'
            });
